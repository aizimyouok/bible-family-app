<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Bible Time for Family</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/SHO8YuH.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Nanum+Myeongjo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .font-myeongjo { font-family: 'Nanum Myeongjo', serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c5a992; border-radius: 10px; }
        
        /* í…Œë§ˆ ì •ì˜ */
        .theme-jerusalem { --bg-main: #fdfaf6; --bg-container: #ffffff; --bg-accent: #f8f1e9; --text-primary: #5a4b42; --text-accent: #8d6e63; --border-color: #d7ccc8; --highlight-bg: #f5e1d3; }
        .theme-creation { --bg-main: #f0f4f8; --bg-container: #ffffff; --bg-accent: #e6f0e6; --text-primary: #2c3e50; --text-accent: #1e8449; --border-color: #d4e6d4; --highlight-bg: #d4edda; }
        .theme-exodus { --bg-main: #f4eade; --bg-container: #fff8f0; --bg-accent: #eaddc7; --text-primary: #4a3f35; --text-accent: #a0522d; --border-color: #d1c4b8; --highlight-bg: #e6dace; }
        .theme-kingdom { --bg-main: #f0f2f5; --bg-container: #ffffff; --bg-accent: #e8eaf6; --text-primary: #37474f; --text-accent: #3f51b5; --border-color: #c5cae9; --highlight-bg: #d9dcf2; }
        
        body { background-color: var(--bg-main); color: var(--text-primary); transition: background-color 0.5s, color 0.5s; }
        .main-container { background-color: var(--bg-container); }
        .accent-bg { background-color: var(--bg-accent); }
        .accent-text { color: var(--text-accent); }
        .highlight-bg { background-color: var(--highlight-bg); }
        .progress-bar-fill { background-color: var(--text-accent); transition: width 0.3s ease-in-out; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        .tab-active { border-color: var(--text-accent); color: var(--text-accent); }
    </style>
</head>
<body class="theme-jerusalem">

    <div id="app" class="relative p-4 md:p-8 max-w-6xl mx-auto">
        <div id="header-top-right" class="absolute top-4 right-4 md:top-8 md:right-8 flex items-center gap-4 z-10">
            <div id="connection-status" class="flex items-center justify-center gap-2">
                <div id="status-indicator" class="w-3 h-3 rounded-full bg-gray-400"></div>
                <span id="status-text" class="text-sm">ì—°ê²° ì¤‘...</span>
                <button id="sync-btn" class="ml-1 px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600 hidden" title="ë™ê¸°í™”">ğŸ”„</button>
            </div>
            <div class="hidden md:block">
                <label for="theme-select" class="mr-2 text-sm">í…Œë§ˆ:</label>
                <select id="theme-select" class="p-1 rounded border-2 text-sm" style="border-color: var(--border-color); background-color: var(--bg-accent);">
                    <option value="theme-jerusalem">ì˜ˆë£¨ì‚´ë ˜</option>
                    <option value="theme-creation">ì²œì§€ì°½ì¡°</option>
                    <option value="theme-exodus">ì¶œì• êµ½</option>
                    <option value="theme-kingdom">ì™•êµ­</option>
                </select>
            </div>
        </div>

        <header class="text-center pt-10 md:pt-0 mb-8">
            <h1 class="text-4xl md:text-5xl font-myeongjo font-bold accent-text">Bible Time for Family</h1>
            <p class="mt-2 text-lg">ìš°ë¦¬ê°€ì¡±, ë§ì”€ìœ¼ë¡œ í•˜ë‚˜ë˜ëŠ” ì‹œê°„</p>
        </header>

        <div class="main-container shadow-xl rounded-2xl p-4 md:p-6">
            <section id="leaderboard" class="mb-8"></section>
            <section id="family-dashboard" class="mb-8 accent-bg rounded-lg p-4 grid grid-cols-2 md:grid-cols-4 gap-4 items-center text-center"></section>
            <section class="mb-8 text-center p-6 border-2 border-dashed" style="border-color: var(--border-color);"><h2 class="text-xl font-bold font-myeongjo accent-text mb-2">ì˜¤ëŠ˜ì˜ ì§€í˜œ ë§ì”€</h2><p id="wisdom-verse" class="text-lg"></p></section>
            <section class="mb-8 space-y-4">
                <details class="group"><summary class="text-2xl font-bold text-center cursor-pointer p-2 rounded-lg hover:bg-gray-100 transition"><span class="group-open:hidden">ğŸ“– êµ¬ì•½ ì„±ê²½ í¼ì¹˜ê¸° â–¼</span><span class="hidden group-open:inline">ğŸ“– êµ¬ì•½ ì„±ê²½ ì ‘ê¸° â–²</span></summary><div class="mt-4"><h3 class="text-xl font-semibold mb-3 text-center accent-text">êµ¬ì•½ (39ê¶Œ)</h3><div id="old-testament" class="grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-5 gap-2"></div></div></details>
                <details class="group"><summary class="text-2xl font-bold text-center cursor-pointer p-2 rounded-lg hover:bg-gray-100 transition"><span class="group-open:hidden">ğŸ“– ì‹ ì•½ ì„±ê²½ í¼ì¹˜ê¸° â–¼</span><span class="hidden group-open:inline">ğŸ“– ì‹ ì•½ ì„±ê²½ ì ‘ê¸° â–²</span></summary><div class="mt-4"><h3 class="text-xl font-semibold mb-3 text-center accent-text">ì‹ ì•½ (27ê¶Œ)</h3><div id="new-testament" class="grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-5 gap-2"></div></div></details>
            </section>
            <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="accent-bg rounded-lg p-4"><h3 class="text-xl font-bold mb-3">ğŸ’¬ ê°€ì¡± ë¬µìƒ ë‚˜ëˆ”</h3><div id="meditation-list" class="h-64 overflow-y-auto custom-scrollbar pr-2 mb-3 bg-white/50 rounded p-2"></div><div class="flex gap-2"><select id="meditation-user" class="p-2 rounded-md" style="border-color: var(--border-color);"></select><input type="text" id="meditation-input" class="flex-grow p-2 rounded-md" placeholder="ì˜¤ëŠ˜ì˜ ë¬µìƒì„ ë‚˜ëˆ ë³´ì„¸ìš”..." style="border-color: var(--border-color);"><button id="add-meditation" class="bg-white/80 hover:bg-white p-2 rounded-md shadow">ë“±ë¡</button></div></div>
                <div class="accent-bg rounded-lg p-4"><h3 class="text-xl font-bold mb-3">ğŸ™ ê°€ì¡± ê¸°ë„ ë…¸íŠ¸</h3><div id="prayer-list" class="h-64 overflow-y-auto custom-scrollbar pr-2 mb-3 bg-white/50 rounded p-2"></div><div class="flex gap-2"><select id="prayer-user" class="p-2 rounded-md" style="border-color: var(--border-color);"></select><input type="text" id="prayer-input" class="flex-grow p-2 rounded-md" placeholder="í•¨ê»˜ ê¸°ë„í•  ì œëª©ì„ ë‚˜ëˆ ìš”..." style="border-color: var(--border-color);"><button id="add-prayer" class="bg-white/80 hover:bg-white p-2 rounded-md shadow">ë“±ë¡</button></div></div>
            </section>
        </div>
    </div>

    <div id="chapter-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-20"><div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-2xl max-h-[80vh] flex flex-col"><div class="flex justify-between items-center mb-4"><h2 id="modal-title" class="text-2xl font-bold"></h2><button id="close-modal" class="text-3xl">&times;</button></div><div id="modal-user-selector-container" class="flex items-center gap-2 mb-4"><label for="modal-user-selector">ì²´í¬í•  ì‚¬ëŒ:</label><select id="modal-user-selector" class="p-1 border rounded"></select></div><div id="modal-chapters" class="flex-grow overflow-y-auto grid grid-cols-5 sm:grid-cols-8 md:grid-cols-10 gap-2 p-2 accent-bg rounded custom-scrollbar"></div></div></div>
    <div id="progress-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-30"><div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-lg max-h-[80vh] flex flex-col"><div class="flex items-center mb-4"><img id="progress-modal-photo" class="w-16 h-16 rounded-full mr-4" src="" alt="í”„ë¡œí•„ ì‚¬ì§„" referrerpolicy="no-referrer"><div class="flex-grow"><h2 id="progress-modal-title" class="text-2xl font-bold"></h2></div><button id="close-progress-modal" class="text-3xl">&times;</button></div><div class="border-b border-gray-200 mb-4"><nav class="-mb-px flex space-x-8" aria-label="Tabs"><button id="tab-ot" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-active">êµ¬ì•½</button><button id="tab-nt" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">ì‹ ì•½</button></nav></div><div id="progress-modal-content" class="flex-grow overflow-y-auto custom-scrollbar pr-4"><div id="content-ot"></div><div id="content-nt" class="hidden"></div></div></div></div>

<script>
class GoogleSheetsAPI { constructor() { this.scriptUrl = 'https://script.google.com/macros/s/AKfycbwrqnyK-9Ft64KN0ecWv8_XaOoZyaBQf8CLYmDgvJjjpcuqLl8dzE0UM1SFsBp8zq7pkA/exec'; this.isConnected = false; } async _request(action, params = {}) { const url = new URL(this.scriptUrl); url.searchParams.set('action', action); for (const key in params) { url.searchParams.set(key, params[key]); } try { const response = await fetch(url.toString()); if (!response.ok) throw new Error(`Server Error: ${response.status}`); const result = await response.json(); if (!result.success) throw new Error(result.error || 'API ìš”ì²­ ì‹¤íŒ¨'); this.isConnected = true; return result; } catch (error) { this.isConnected = false; updateConnectionStatus('disconnected'); console.error(`API Error (${action}):`, error); throw error; } } async testConnection() { await this._request('test'); return true; } async loadAllData() { const result = await this._request('loadAll'); for (const sheetName in result.data) { localStorage.setItem(`bible_${sheetName}`, JSON.stringify(result.data[sheetName])); } return result.data; } async saveData(params) { return this._request('save', params); } async deleteData(params) { return this._request('delete', params); } async editData(params) { return this._request('edit', params); } }
const BIBLE_BOOKS = { old: [ { name: 'ì°½ì„¸ê¸°', chapters: 50 }, { name: 'ì¶œì• êµ½ê¸°', chapters: 40 }, { name: 'ë ˆìœ„ê¸°', chapters: 27 }, { name: 'ë¯¼ìˆ˜ê¸°', chapters: 36 }, { name: 'ì‹ ëª…ê¸°', chapters: 34 }, { name: 'ì—¬í˜¸ìˆ˜ì•„', chapters: 24 }, { name: 'ì‚¬ì‚¬ê¸°', chapters: 21 }, { name: 'ë£»ê¸°', chapters: 4 }, { name: 'ì‚¬ë¬´ì—˜ìƒ', chapters: 31 }, { name: 'ì‚¬ë¬´ì—˜í•˜', chapters: 24 }, { name: 'ì—´ì™•ê¸°ìƒ', chapters: 22 }, { name: 'ì—´ì™•ê¸°í•˜', chapters: 25 }, { name: 'ì—­ëŒ€ìƒ', chapters: 29 }, { name: 'ì—­ëŒ€í•˜', chapters: 36 }, { name: 'ì—ìŠ¤ë¼', chapters: 10 }, { name: 'ëŠí—¤ë¯¸ì•¼', chapters: 13 }, { name: 'ì—ìŠ¤ë”', chapters: 10 }, { name: 'ìš¥ê¸°', chapters: 42 }, { name: 'ì‹œí¸', chapters: 150 }, { name: 'ì ì–¸', chapters: 31 }, { name: 'ì „ë„ì„œ', chapters: 12 }, { name: 'ì•„ê°€', chapters: 8 }, { name: 'ì´ì‚¬ì•¼', chapters: 66 }, { name: 'ì˜ˆë ˆë¯¸ì•¼', chapters: 52 }, { name: 'ì˜ˆë ˆë¯¸ì•¼ì• ê°€', chapters: 5 }, { name: 'ì—ìŠ¤ê²”', chapters: 48 }, { name: 'ë‹¤ë‹ˆì—˜', chapters: 12 }, { name: 'í˜¸ì„¸ì•„', chapters: 14 }, { name: 'ìš”ì—˜', chapters: 3 }, { name: 'ì•„ëª¨ìŠ¤', chapters: 9 }, { name: 'ì˜¤ë°”ëŒœ', chapters: 1 }, { name: 'ìš”ë‚˜', chapters: 4 }, { name: 'ë¯¸ê°€', chapters: 7 }, { name: 'ë‚˜í›”', chapters: 3 }, { name: 'í•˜ë°•êµ­', chapters: 3 }, { name: 'ìŠ¤ë°”ëƒ', chapters: 3 }, { name: 'í•™ê°œ', chapters: 2 }, { name: 'ìŠ¤ê°€ë´', chapters: 14 }, { name: 'ë§ë¼ê¸°', chapters: 4 } ], new: [ { name: 'ë§ˆíƒœë³µìŒ', chapters: 28 }, { name: 'ë§ˆê°€ë³µìŒ', chapters: 16 }, { name: 'ëˆ„ê°€ë³µìŒ', chapters: 24 }, { name: 'ìš”í•œë³µìŒ', chapters: 21 }, { name: 'ì‚¬ë„í–‰ì „', chapters: 28 }, { name: 'ë¡œë§ˆì„œ', chapters: 16 }, { name: 'ê³ ë¦°ë„ì „ì„œ', chapters: 16 }, { name: 'ê³ ë¦°ë„í›„ì„œ', chapters: 13 }, { name: 'ê°ˆë¼ë””ì•„ì„œ', chapters: 6 }, { name: 'ì—ë² ì†Œì„œ', chapters: 6 }, { name: 'ë¹Œë¦½ë³´ì„œ', chapters: 4 }, { name: 'ê³¨ë¡œìƒˆì„œ', chapters: 4 }, { name: 'ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ', chapters: 5 }, { name: 'ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ', chapters: 3 }, { name: 'ë””ëª¨ë°ì „ì„œ', chapters: 6 }, { name: 'ë””ëª¨ë°í›„ì„œ', chapters: 4 }, { name: 'ë””ë„ì„œ', chapters: 3 }, { name: 'ë¹Œë ˆëª¬ì„œ', chapters: 1 }, { name: 'íˆë¸Œë¦¬ì„œ', chapters: 13 }, { name: 'ì•¼ê³ ë³´ì„œ', chapters: 5 }, { name: 'ë² ë“œë¡œì „ì„œ', chapters: 5 }, { name: 'ë² ë“œë¡œí›„ì„œ', chapters: 3 }, { name: 'ìš”í•œ1ì„œ', chapters: 5 }, { name: 'ìš”í•œ2ì„œ', chapters: 1 }, { name: 'ìš”í•œ3ì„œ', chapters: 1 }, { name: 'ìœ ë‹¤ì„œ', chapters: 1 }, { name: 'ìš”í•œê³„ì‹œë¡', chapters: 22 } ] };
const TOTAL_OT_CHAPTERS = BIBLE_BOOKS.old.reduce((s, b) => s + b.chapters, 0);
const TOTAL_NT_CHAPTERS = BIBLE_BOOKS.new.reduce((s, b) => s + b.chapters, 0);
let gapi = new GoogleSheetsAPI();
let db = { family: [], readRecords: {}, badges: {}, meditations: [], prayers: [] };
let currentUserForModal = null, currentBook = null, currentProgressUserId = null;

document.addEventListener('DOMContentLoaded', async () => { setupEventListeners(); renderWisdomVerse(); renderBibleBooks(); await initializeApp(); });
async function initializeApp() { updateConnectionStatus('loading'); try { await gapi.testConnection(); updateConnectionStatus('connected'); await loadAllDataAndRender(); } catch (error) { updateConnectionStatus('disconnected'); } }
async function loadAllDataAndRender() { try { const allData = await gapi.loadAllData(); db.family = allData.family_members || []; db.readRecords = allData.reading_records || {}; db.badges = allData.badges || {}; db.meditations = allData.meditations || []; db.prayers = allData.prayers || []; if (db.family?.length > 0) { currentUserForModal = db.family[0].id; populateUserDropdowns(); renderAll(); } else if (gapi.isConnected) { alert("ê°€ì¡± ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. êµ¬ê¸€ ì‹œíŠ¸ì˜ 'family_members' ì‹œíŠ¸ì— ë°ì´í„°ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”."); } } catch (error) { console.error('ì „ì²´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error); } }
function renderAll() { renderLeaderboard(); renderFamilyDashboard(); renderMeditations(); renderPrayers(); }

// [ë¦¬ë”ë³´ë“œ ê°œì„ ] ê³µë™ ìˆœìœ„ ë° ì „ì²´ ìˆœìœ„ í‘œì‹œ
function renderLeaderboard() {
    const board = document.getElementById('leaderboard');
    if (!db.family || db.family.length === 0) { board.innerHTML = ''; return; }

    const rankedUsers = db.family.map(member => {
        const chaptersRead = Object.values(db.readRecords[member.id] || {}).reduce((sum, chapters) => sum + chapters.length, 0);
        return { ...member, chaptersRead };
    }).sort((a, b) => b.chaptersRead - a.chaptersRead);

    if (rankedUsers.length === 0 || rankedUsers[0].chaptersRead === 0) {
        board.innerHTML = `<div class="text-center p-4 accent-bg rounded-lg"><p>ì•„ì§ ì„±ê²½ ì½ê¸° ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. í•¨ê»˜ ì‹œì‘í•´ë³¼ê¹Œìš”?</p></div>`;
        return;
    }

    const topScore = rankedUsers[0].chaptersRead;
    const winners = rankedUsers.filter(user => user.chaptersRead === topScore);
    const others = rankedUsers.filter(user => user.chaptersRead < topScore);

    const winnersHTML = `
        <div class="flex-shrink-0 w-full md:w-1/2 text-center md:text-left">
            <h3 class="text-xl font-bold accent-text mb-2">${winners.length > 1 ? 'ğŸ† ê³µë™ 1ë“±! ğŸ†' : 'ğŸ† ë§ì”€ ì½ê¸° 1ë“±! ğŸ†'}</h3>
            <div class="flex items-center justify-center md:justify-start gap-4">
                <div class="flex -space-x-4">
                    ${winners.map(winner => `<img src="${winner.photo || 'https://placehold.co/80x80/cccccc/FFFFFF?text=?'}" alt="${winner.name}" class="w-16 h-16 rounded-full border-4 border-yellow-400 object-cover" referrerpolicy="no-referrer">`).join('')}
                </div>
                <div>
                    <p class="text-xl font-bold">${winners.map(w => w.name).join(', ')}</p>
                    <p class="text-lg">${topScore}ì¥</p>
                </div>
            </div>
        </div>`;

    let othersHTML = '<div class="flex-grow pt-4 md:pt-0 md:pl-6 w-full md:w-1/2">';
    if (others.length > 0) {
        let currentRank = winners.length + 1;
        others.slice(0, 3).forEach(user => { // 1ë“± ì œì™¸ ìµœëŒ€ 3ëª…
            othersHTML += `
                <div class="flex items-center justify-between text-sm mb-2">
                    <div class="flex items-center">
                        <span class="font-bold w-8 text-left">${currentRank}.</span>
                        <img src="${user.photo || 'https://placehold.co/40x40/cccccc/FFFFFF?text=?'}" alt="${user.name}" class="w-8 h-8 rounded-full mr-2 object-cover" referrerpolicy="no-referrer">
                        <span>${user.name}</span>
                    </div>
                    <span class="font-semibold">${user.chaptersRead}ì¥</span>
                </div>`;
            currentRank++;
        });
    }
    othersHTML += '</div>';

    board.innerHTML = `<div class="p-4 accent-bg rounded-lg flex flex-col md:flex-row items-center">${winnersHTML}${othersHTML}</div>`;
}

function updateConnectionStatus(status) { const indicator = document.getElementById('status-indicator'); const text = document.getElementById('status-text'); const syncBtn = document.getElementById('sync-btn'); indicator.classList.remove('loading'); switch (status) { case 'connected': indicator.className = 'w-3 h-3 rounded-full bg-green-500'; text.textContent = 'ì˜¨ë¼ì¸'; syncBtn.classList.remove('hidden'); break; case 'disconnected': indicator.className = 'w-3 h-3 rounded-full bg-red-500'; text.textContent = 'ì˜¤í”„ë¼ì¸'; syncBtn.classList.add('hidden'); break; case 'loading': indicator.className = 'w-3 h-3 rounded-full bg-yellow-500 loading'; text.textContent = 'ì—°ê²° ì¤‘...'; syncBtn.classList.add('hidden'); break; } }
function renderFamilyDashboard() { const dashboard = document.getElementById('family-dashboard'); dashboard.innerHTML = ''; if (!db.family || db.family.length === 0) return; db.family.forEach(member => { const userRecords = db.readRecords[member.id] || {}; const otRead = BIBLE_BOOKS.old.reduce((sum, book) => sum + (userRecords[book.name]?.length || 0), 0); const ntRead = BIBLE_BOOKS.new.reduce((sum, book) => sum + (userRecords[book.name]?.length || 0), 0); const totalRead = otRead + ntRead; const totalChapters = TOTAL_OT_CHAPTERS + TOTAL_NT_CHAPTERS; const memberDiv = document.createElement('div'); memberDiv.className = 'flex flex-col items-center cursor-pointer hover:opacity-80 transition'; memberDiv.onclick = () => openProgressModal(member.id); memberDiv.innerHTML = `<img src="${member.photo || 'https://placehold.co/80x80/cccccc/FFFFFF?text=?'}" alt="${member.name}" class="w-16 h-16 md:w-20 md:h-20 rounded-full border-4 border-white/50 object-cover shadow-md" referrerpolicy="no-referrer"><div class="font-bold mt-2">${member.title} (${member.name})</div><div class="text-sm mt-2 space-y-1"><div><strong>ì´:</strong> ${totalRead} / ${totalChapters}</div><div class="text-xs"><strong>êµ¬ì•½:</strong> ${otRead}/${TOTAL_OT_CHAPTERS} | <strong>ì‹ ì•½:</strong> ${ntRead}/${TOTAL_NT_CHAPTERS}</div></div>`; dashboard.appendChild(memberDiv); }); }
function renderWisdomVerse() { const verses = [ "ìë…€ë“¤ì•„ ì£¼ ì•ˆì—ì„œ ë„ˆí¬ ë¶€ëª¨ì—ê²Œ ìˆœì¢…í•˜ë¼ ì´ê²ƒì´ ì˜³ìœ¼ë‹ˆë¼ (ì—ë² ì†Œì„œ 6:1)","ì—¬í˜¸ì™€ëŠ” ë‚˜ì˜ ëª©ìì‹œë‹ˆ ë‚´ê²Œ ë¶€ì¡±í•¨ì´ ì—†ìœ¼ë¦¬ë¡œë‹¤ (ì‹œí¸ 23:1)","ì£¼ ë„ˆì˜ í•˜ë‚˜ë‹˜ì„ ì‚¬ë‘í•˜ê³  ë˜í•œ ë„¤ ì´ì›ƒì„ ë„¤ ìì‹  ê°™ì´ ì‚¬ë‘í•˜ë¼ (ë§ˆíƒœë³µìŒ 22:37-39)","í•­ìƒ ê¸°ë»í•˜ë¼ ì‰¬ì§€ ë§ê³  ê¸°ë„í•˜ë¼ ë²”ì‚¬ì— ê°ì‚¬í•˜ë¼ (ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ 5:16-18)","ìˆ˜ê³ í•˜ê³  ë¬´ê±°ìš´ ì§ ì§„ ìë“¤ì•„ ë‹¤ ë‚´ê²Œë¡œ ì˜¤ë¼ ë‚´ê°€ ë„ˆí¬ë¥¼ ì‰¬ê²Œ í•˜ë¦¬ë¼ (ë§ˆíƒœë³µìŒ 11:28)","ë‘ë ¤ì›Œí•˜ì§€ ë§ë¼ ë‚´ê°€ ë„ˆì™€ í•¨ê»˜ í•¨ì´ë¼ ë†€ë¼ì§€ ë§ë¼ ë‚˜ëŠ” ë„¤ í•˜ë‚˜ë‹˜ì´ ë¨ì´ë¼ (ì´ì‚¬ì•¼ 41:10)","ì‚¬ëŒì´ ë§ˆìŒìœ¼ë¡œ ìê¸°ì˜ ê¸¸ì„ ê³„íší• ì§€ë¼ë„ ê·¸ì˜ ê±¸ìŒì„ ì¸ë„í•˜ì‹œëŠ” ì´ëŠ” ì—¬í˜¸ì™€ì‹œë‹ˆë¼ (ì ì–¸ 16:9)","ê·¸ëŸ°ì¦‰ ë„ˆí¬ëŠ” ë¨¼ì € ê·¸ì˜ ë‚˜ë¼ì™€ ê·¸ì˜ ì˜ë¥¼ êµ¬í•˜ë¼ ê·¸ë¦¬í•˜ë©´ ì´ ëª¨ë“  ê²ƒì„ ë„ˆí¬ì—ê²Œ ë”í•˜ì‹œë¦¬ë¼ (ë§ˆíƒœë³µìŒ 6:33)","ë‚´ê²Œ ëŠ¥ë ¥ ì£¼ì‹œëŠ” ì ì•ˆì—ì„œ ë‚´ê°€ ëª¨ë“  ê²ƒì„ í•  ìˆ˜ ìˆëŠë‹ˆë¼ (ë¹Œë¦½ë³´ì„œ 4:13)","ë‚´ê°€ ë„ˆí¬ì—ê²Œ ë¶„ë¶€í•œ ëª¨ë“  ê²ƒì„ ê°€ë¥´ì³ ì§€í‚¤ê²Œ í•˜ë¼ ë³¼ì§€ì–´ë‹¤ ë‚´ê°€ ì„¸ìƒ ëë‚ ê¹Œì§€ ë„ˆí¬ì™€ í•­ìƒ í•¨ê»˜ ìˆìœ¼ë¦¬ë¼ (ë§ˆíƒœë³µìŒ 28:20)","ì‚¬ë‘ì€ ì˜¤ë˜ ì°¸ê³  ì‚¬ë‘ì€ ì˜¨ìœ í•˜ë©° ì‹œê¸°í•˜ì§€ ì•„ë‹ˆí•˜ë©° (ê³ ë¦°ë„ì „ì„œ 13:4)","í•˜ë‚˜ë‹˜ì´ ì„¸ìƒì„ ì´ì²˜ëŸ¼ ì‚¬ë‘í•˜ì‚¬ ë…ìƒìë¥¼ ì£¼ì…¨ìœ¼ë‹ˆ ì´ëŠ” ê·¸ë¥¼ ë¯¿ëŠ” ìë§ˆë‹¤ ë©¸ë§í•˜ì§€ ì•Šê³  ì˜ìƒì„ ì–»ê²Œ í•˜ë ¤ í•˜ì‹¬ì´ë¼ (ìš”í•œë³µìŒ 3:16)","ê·¸ëŸ°ì¦‰ ë„ˆí¬ê°€ ë¨¹ë“ ì§€ ë§ˆì‹œë“ ì§€ ë¬´ì—‡ì„ í•˜ë“ ì§€ ë‹¤ í•˜ë‚˜ë‹˜ì˜ ì˜ê´‘ì„ ìœ„í•˜ì—¬ í•˜ë¼ (ê³ ë¦°ë„ì „ì„œ 10:31)" ]; document.getElementById('wisdom-verse').textContent = verses[Math.floor(Math.random() * verses.length)]; }
function renderBibleBooks() { const oldDiv = document.getElementById('old-testament'); const newDiv = document.getElementById('new-testament'); oldDiv.innerHTML = ''; newDiv.innerHTML = ''; const createEl = (book) => { const el = document.createElement('button'); el.className = 'p-2 text-sm rounded-md shadow-sm transition-all duration-200 accent-bg hover:shadow-lg hover:-translate-y-1'; el.textContent = book.name; el.onclick = () => openChapterModal(book); return el; }; BIBLE_BOOKS.old.forEach(book => oldDiv.appendChild(createEl(book))); BIBLE_BOOKS.new.forEach(book => newDiv.appendChild(createEl(book))); }
function populateUserDropdowns() { const meditationUser = document.getElementById('meditation-user'); const prayerUser = document.getElementById('prayer-user'); const modalUser = document.getElementById('modal-user-selector'); meditationUser.innerHTML = ''; prayerUser.innerHTML = ''; modalUser.innerHTML = ''; db.family.forEach(member => { const option = `<option value="${member.id}">${member.name}</option>`; meditationUser.innerHTML += option; prayerUser.innerHTML += option; modalUser.innerHTML += option; }); }
function setupEventListeners() { document.getElementById('theme-select').addEventListener('change', (e) => { document.body.className = e.target.value; }); document.getElementById('add-meditation').addEventListener('click', addMeditation); document.getElementById('meditation-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') addMeditation(); }); document.getElementById('meditation-user').addEventListener('change', renderMeditations); document.getElementById('add-prayer').addEventListener('click', addPrayer); document.getElementById('prayer-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') addPrayer(); }); document.getElementById('prayer-user').addEventListener('change', renderPrayers); document.getElementById('sync-btn').addEventListener('click', () => { initializeApp(); }); document.getElementById('close-modal').onclick = closeChapterModal; document.getElementById('modal-user-selector').addEventListener('change', (e) => { currentUserForModal = e.target.value; updateModalForCurrentUser(); }); document.getElementById('close-progress-modal').onclick = closeProgressModal; document.getElementById('tab-ot').onclick = () => switchProgressTab('ot'); document.getElementById('tab-nt').onclick = () => switchProgressTab('nt'); }
function renderMeditations() { const list = document.getElementById('meditation-list'); list.innerHTML = ''; const currentUserId = document.getElementById('meditation-user').value; (db.meditations || []).forEach(item => { const user = db.family.find(u => u.id === item.userId); const itemEl = document.createElement('div'); itemEl.className = 'p-2 mb-2 rounded bg-white/70 text-sm'; let buttons = (item.userId === currentUserId) ? `<div class="inline-block ml-2"><button onclick="editMeditation('${item.id}')" class="text-xs text-blue-600 hover:underline">ìˆ˜ì •</button> <button onclick="deleteMeditation('${item.id}')" class="text-xs text-red-600 hover:underline">ì‚­ì œ</button></div>` : ''; itemEl.innerHTML = `<div><strong class="accent-text">${user ? user.name : '?'}:</strong> ${item.content}</div><div class="text-right text-gray-500 text-xs">${new Date(parseInt(item.id)).toLocaleDateString()} ${buttons}</div>`; list.appendChild(itemEl); }); list.scrollTop = list.scrollHeight; }
function renderPrayers() { const list = document.getElementById('prayer-list'); list.innerHTML = ''; const currentUserId = document.getElementById('prayer-user').value; (db.prayers || []).forEach(item => { const user = db.family.find(u => u.id === item.userId); const itemEl = document.createElement('div'); itemEl.className = 'p-2 mb-2 rounded bg-white/70 text-sm'; let buttons = (item.userId === currentUserId) ? `<div class="inline-block ml-2"><button onclick="editPrayer('${item.id}')" class="text-xs text-blue-600 hover:underline">ìˆ˜ì •</button> <button onclick="deletePrayer('${item.id}')" class="text-xs text-red-600 hover:underline">ì‚­ì œ</button></div>` : ''; itemEl.innerHTML = `<div><strong class="accent-text">${user ? user.name : '?'}:</strong> ${item.content}</div><div class="text-right text-gray-500 text-xs">${new Date(parseInt(item.id)).toLocaleDateString()} ${buttons}</div>`; list.appendChild(itemEl); }); list.scrollTop = list.scrollHeight; }
async function addMeditation() { const userInput = document.getElementById('meditation-user'); const textInput = document.getElementById('meditation-input'); if (textInput.value.trim() === '') return; try { const result = await gapi.saveData({ type: 'meditation', userId: userInput.value, content: textInput.value.trim() }); db.meditations.push(result.data); textInput.value = ''; renderMeditations(); } catch (error) { alert('ë¬µìƒ ì €ì¥ ì‹¤íŒ¨: ' + error.message); } }
async function deleteMeditation(id) { if (!confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; try { await gapi.deleteData({ type: 'meditation', id: id }); db.meditations = db.meditations.filter(item => item.id !== id); renderMeditations(); } catch (error) { alert('ë¬µìƒ ì‚­ì œ ì‹¤íŒ¨: ' + error.message); } }
async function editMeditation(id) { const item = db.meditations.find(item => item.id === id); const newContent = prompt('ë¬µìƒ ë‚´ìš© ìˆ˜ì •:', item.content); if (newContent === null || newContent.trim() === '' || newContent.trim() === item.content) return; try { await gapi.editData({ type: 'meditation', id: id, content: newContent.trim() }); item.content = newContent.trim(); renderMeditations(); } catch (error) { alert('ë¬µìƒ ìˆ˜ì • ì‹¤íŒ¨: ' + error.message); } }
async function addPrayer() { const userInput = document.getElementById('prayer-user'); const textInput = document.getElementById('prayer-input'); if (textInput.value.trim() === '') return; try { const result = await gapi.saveData({ type: 'prayer', userId: userInput.value, content: textInput.value.trim() }); db.prayers.push(result.data); textInput.value = ''; renderPrayers(); } catch (error) { alert('ê¸°ë„ì œëª© ì €ì¥ ì‹¤íŒ¨: ' + error.message); } }
async function deletePrayer(id) { if (!confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; try { await gapi.deleteData({ type: 'prayer', id: id }); db.prayers = db.prayers.filter(item => item.id !== id); renderPrayers(); } catch (error) { alert('ê¸°ë„ì œëª© ì‚­ì œ ì‹¤íŒ¨: ' + error.message); } }
async function editPrayer(id) { const item = db.prayers.find(item => item.id === id); const newContent = prompt('ê¸°ë„ì œëª© ìˆ˜ì •:', item.content); if (newContent === null || newContent.trim() === '' || newContent.trim() === item.content) return; try { await gapi.editData({ type: 'prayer', id: id, content: newContent.trim() }); item.content = newContent.trim(); renderPrayers(); } catch (error) { alert('ê¸°ë„ì œëª© ìˆ˜ì • ì‹¤íŒ¨: ' + error.message); } }
function openProgressModal(userId) { currentProgressUserId = userId; const user = db.family.find(u => u.id === userId); if (!user) return; document.getElementById('progress-modal-photo').src = user.photo || 'https://placehold.co/80x80/cccccc/FFFFFF?text=?'; document.getElementById('progress-modal-title').textContent = `${user.name}ë‹˜ì˜ ì§„í–‰ í˜„í™©`; const contentOT = document.getElementById('content-ot'); const contentNT = document.getElementById('content-nt'); contentOT.innerHTML = ''; contentNT.innerHTML = ''; const createBookHTML = (book) => { return `<details class="group border-b border-gray-200 rounded-md overflow-hidden mb-1" data-book-name="${book.name}"><summary class="flex justify-between items-center p-2 cursor-pointer hover:bg-gray-50/50"></summary><div class="chapter-grid p-2 grid grid-cols-5 sm:grid-cols-8 md:grid-cols-10 gap-2 bg-gray-50 border-t"></div></details>`; }; BIBLE_BOOKS.old.forEach(book => contentOT.innerHTML += createBookHTML(book)); BIBLE_BOOKS.new.forEach(book => contentNT.innerHTML += createBookHTML(book)); document.querySelectorAll('#progress-modal details').forEach(detail => { updateProgressInModal(detail, userId); detail.querySelector('summary').addEventListener('click', populateChaptersForBook); }); switchProgressTab('ot'); document.getElementById('progress-modal').classList.remove('hidden'); }
function populateChaptersForBook(event) { const detail = event.currentTarget.parentElement; const grid = detail.querySelector('.chapter-grid'); if (grid.childElementCount > 0) { grid.innerHTML = ''; return; } const bookName = detail.dataset.bookName; const book = [...BIBLE_BOOKS.old, ...BIBLE_BOOKS.new].find(b => b.name === bookName); const userRecordsForBook = (db.readRecords[currentProgressUserId]?.[bookName]) || []; for (let i = 1; i <= book.chapters; i++) { const btn = document.createElement('button'); btn.textContent = i; btn.className = `p-2 rounded border transition-colors duration-200 ${userRecordsForBook.includes(i) ? 'bg-green-500 text-white border-green-500' : 'bg-white hover:bg-green-100'}`; btn.onclick = (e) => { e.stopPropagation(); toggleChapterRead(i, btn, { bookName: book.name, userId: currentProgressUserId }); }; grid.appendChild(btn); } }
function updateProgressInModal(detailElement, userId) { const summary = detailElement.querySelector('summary'); const bookName = detailElement.dataset.bookName; const book = [...BIBLE_BOOKS.old, ...BIBLE_BOOKS.new].find(b => b.name === bookName); const readChapters = (db.readRecords[userId]?.[bookName]) || []; const progress = book.chapters > 0 ? (readChapters.length / book.chapters) * 100 : 0; const isReading = readChapters.length > 0; detailElement.classList.toggle('highlight-bg', isReading); summary.innerHTML = `<div class="flex-grow font-bold">${book.name}</div><div class="text-sm text-gray-600 mr-4">${readChapters.length}/${book.chapters} ì¥</div><div class="w-24 bg-gray-200 rounded-full h-2.5"><div class="progress-bar-fill h-2.5 rounded-full" style="width: ${progress.toFixed(2)}%"></div></div><div class="w-4 ml-2 transform group-open:rotate-180 transition-transform">â–¼</div>`; }
function closeProgressModal() { document.getElementById('progress-modal').classList.add('hidden'); }
function switchProgressTab(tab) { const tabOT = document.getElementById('tab-ot'); const tabNT = document.getElementById('tab-nt'); const contentOT = document.getElementById('content-ot'); const contentNT = document.getElementById('content-nt'); if (tab === 'ot') { tabOT.classList.add('tab-active'); tabOT.classList.remove('border-transparent', 'text-gray-500'); tabNT.classList.remove('tab-active'); tabNT.classList.add('border-transparent', 'text-gray-500'); contentOT.classList.remove('hidden'); contentNT.classList.add('hidden'); } else { tabNT.classList.add('tab-active'); tabNT.classList.remove('border-transparent', 'text-gray-500'); tabOT.classList.remove('tab-active'); tabOT.classList.add('border-transparent', 'text-gray-500'); contentNT.classList.remove('hidden'); contentOT.classList.add('hidden'); } }
function toggleChapterRead(chapterNumber, buttonElement, context) { const userId = context.userId; const bookName = context.bookName; if (!db.readRecords[userId]) db.readRecords[userId] = {}; if (!db.readRecords[userId][bookName]) db.readRecords[userId][bookName] = []; const readList = db.readRecords[userId][bookName]; const chapterIndex = readList.indexOf(chapterNumber); const params = { type: 'reading', userId, bookName, chapter: chapterNumber }; if (chapterIndex > -1) { readList.splice(chapterIndex, 1); buttonElement.className = 'p-2 rounded border transition-colors duration-200 bg-white hover:bg-green-100'; } else { readList.push(chapterNumber); buttonElement.className = 'p-2 rounded border transition-colors duration-200 bg-green-500 text-white border-green-500'; } renderAll(); const detail = document.querySelector(`#progress-modal details[data-book-name="${bookName}"]`); if(detail) updateProgressInModal(detail, userId); const apiCall = (chapterIndex > -1) ? gapi.deleteData(params) : gapi.saveData(params); apiCall.catch(error => { alert(`ì½ê¸° ìƒíƒœ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`); const originalIndex = readList.indexOf(chapterNumber); if (originalIndex > -1) { readList.splice(originalIndex, 1); } else { readList.push(chapterNumber); } buttonElement.className = `p-2 rounded border transition-colors duration-200 ${readList.includes(chapterNumber) ? 'bg-green-500 text-white border-green-500' : 'bg-white hover:bg-green-100'}`; renderAll(); if(detail) updateProgressInModal(detail, userId); }); }
function openChapterModal(book) { if (!db.family || db.family.length === 0) return; currentBook = book; document.getElementById('modal-title').textContent = book.name; document.getElementById('modal-user-selector').value = currentUserForModal; updateModalForCurrentUser(); document.getElementById('chapter-modal').classList.remove('hidden'); }
function updateModalForCurrentUser() { const modalChapters = document.getElementById('modal-chapters'); modalChapters.innerHTML = ''; const userRecordsForBook = (db.readRecords[currentUserForModal]?.[currentBook.name]) || []; for (let i = 1; i <= currentBook.chapters; i++) { const btn = document.createElement('button'); btn.textContent = i; btn.className = `p-2 rounded border transition-colors duration-200 ${userRecordsForBook.includes(i) ? 'bg-green-500 text-white border-green-500' : 'bg-white hover:bg-green-100'}`; btn.onclick = () => toggleChapterRead(i, btn, {bookName: currentBook.name, userId: currentUserForModal}); modalChapters.appendChild(btn); } }
function closeChapterModal() { document.getElementById('chapter-modal').classList.add('hidden'); }
</script>
</body>
</html>
